# chatbot_model.py
import random

# Multilingual responses (English, Hindi, Tamil)
RESPONSES = {
    "greeting": {
        "en": [
            "Hello! I'm your agriculture assistant. ðŸŒ± How can I help you today?",
            "Hi there! Ask me anything about farming and crops. ðŸšœ"
        ],
        "hi": [
            "à¤¨à¤®à¤¸à¥à¤¤à¥‡! à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¤¾ à¤•à¥ƒà¤·à¤¿ à¤¸à¤¹à¤¾à¤¯à¤• à¤¹à¥‚à¤à¥¤ ðŸŒ± à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¥€ à¤•à¥ˆà¤¸à¥‡ à¤®à¤¦à¤¦ à¤•à¤° à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤?",
            "à¤¹à¤¾à¤¯! à¤–à¥‡à¤¤à¥€ à¤”à¤° à¤«à¤¸à¤²à¥‹à¤‚ à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤•à¥à¤› à¤­à¥€ à¤ªà¥‚à¤› à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ ðŸšœ"
        ],
        "ta": [
            "à®µà®£à®•à¯à®•à®®à¯! à®¨à®¾à®©à¯ à®‰à®™à¯à®•à®³à¯ à®µà¯‡à®³à®¾à®£à¯ à®‰à®¤à®µà®¿à®¯à®¾à®³à®°à¯. ðŸŒ¾ à®‡à®©à¯à®±à¯ à®‰à®™à¯à®•à®³à¯à®•à¯à®•à¯ à®Žà®©à¯à®© à®‰à®¤à®µà®¿ à®µà¯‡à®£à¯à®Ÿà¯à®®à¯?",
            "à®¹à®¾à®¯à¯! à®µà®¿à®µà®šà®¾à®¯à®®à¯ à®®à®±à¯à®±à¯à®®à¯ à®ªà®¯à®¿à®°à¯à®•à®³à¯ à®•à¯à®±à®¿à®¤à¯à®¤à¯ à®Žà®¤à¯ˆ à®µà¯‡à®£à¯à®Ÿà¯à®®à®¾à®©à®¾à®²à¯à®®à¯ à®•à¯‡à®³à¯à®™à¯à®•à®³à¯. ðŸšœ"
        ]
    },
    "fertilizer": {
        "en": [
            "For better yield, use organic compost and nitrogen-rich fertilizer like urea.",
            "Consider using phosphorus and potassium-based fertilizers for root growth."
        ],
        "hi": [
            "à¤¬à¥‡à¤¹à¤¤à¤° à¤‰à¤¤à¥à¤ªà¤¾à¤¦à¤¨ à¤•à¥‡ à¤²à¤¿à¤, à¤œà¥ˆà¤µà¤¿à¤• à¤–à¤¾à¤¦ à¤”à¤° à¤¨à¤¾à¤‡à¤Ÿà¥à¤°à¥‹à¤œà¤¨ à¤¯à¥à¤•à¥à¤¤ à¤‰à¤°à¥à¤µà¤°à¤• à¤œà¥ˆà¤¸à¥‡ à¤¯à¥‚à¤°à¤¿à¤¯à¤¾ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¥‡à¤‚à¥¤",
            "à¤œà¤¡à¤¼ à¤µà¤¿à¤•à¤¾à¤¸ à¤•à¥‡ à¤²à¤¿à¤ à¤«à¥‰à¤¸à¥à¤«à¥‹à¤°à¤¸ à¤”à¤° à¤ªà¥‹à¤Ÿà¥ˆà¤¶à¤¿à¤¯à¤® à¤†à¤§à¤¾à¤°à¤¿à¤¤ à¤‰à¤°à¥à¤µà¤°à¤•à¥‹à¤‚ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¥‡à¤‚à¥¤"
        ],
        "ta": [
            "à®šà®¿à®±à®¨à¯à®¤ à®µà®¿à®³à¯ˆà®šà¯à®šà®²à¯à®•à¯à®•à¯, à®‡à®¯à®±à¯à®•à¯ˆ à®‰à®°à®®à¯ à®®à®±à¯à®±à¯à®®à¯ à®¯à¯‚à®°à®¿à®¯à®¾ à®ªà¯‹à®©à¯à®± à®¨à¯ˆà®Ÿà¯à®°à®œà®©à¯ à®¨à®¿à®±à¯ˆà®¨à¯à®¤ à®‰à®°à®¤à¯à®¤à¯ˆ à®ªà®¯à®©à¯à®ªà®Ÿà¯à®¤à¯à®¤à¯à®™à¯à®•à®³à¯.",
            "à®µà¯‡à®°à¯ à®µà®³à®°à¯à®šà¯à®šà®¿à®•à¯à®•à¯ à®ªà®¾à®¸à¯à®ªà®°à®¸à¯ à®®à®±à¯à®±à¯à®®à¯ à®ªà¯Šà®Ÿà¯à®Ÿà®¾à®šà®¿à®¯à®®à¯ à®…à®Ÿà®¿à®ªà¯à®ªà®Ÿà¯ˆà®¯à®¿à®²à®¾à®© à®‰à®°à®™à¯à®•à®³à¯ˆ à®ªà®¯à®©à¯à®ªà®Ÿà¯à®¤à¯à®¤à¯à®™à¯à®•à®³à¯."
        ]
    },
    "pest": {
        "en": [
            "Neem oil spray is effective for many pests.",
            "Introduce natural predators like ladybugs to control pest population."
        ],
        "hi": [
            "à¤¨à¥€à¤® à¤•à¤¾ à¤¤à¥‡à¤² à¤•à¤ˆ à¤•à¥€à¤¡à¤¼à¥‹à¤‚ à¤•à¥‡ à¤²à¤¿à¤ à¤ªà¥à¤°à¤­à¤¾à¤µà¥€ à¤¹à¥ˆà¥¤",
            "à¤•à¥€à¤Ÿ à¤†à¤¬à¤¾à¤¦à¥€ à¤•à¥‹ à¤¨à¤¿à¤¯à¤‚à¤¤à¥à¤°à¤¿à¤¤ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤ªà¥à¤°à¤¾à¤•à¥ƒà¤¤à¤¿à¤• à¤¶à¤¿à¤•à¤¾à¤°à¥€ à¤œà¥ˆà¤¸à¥‡ à¤²à¥‡à¤¡à¥€à¤¬à¤—à¥à¤¸ à¤•à¤¾ à¤ªà¤°à¤¿à¤šà¤¯ à¤¦à¥‡à¤‚à¥¤"
        ],
        "ta": [
            "à®µà¯†à®ªà¯à®ªà®šà¯à®šà¯†à®Ÿà®¿ à®Žà®£à¯à®£à¯†à®¯à¯ à®¤à¯†à®³à®¿à®ªà¯à®ªà¯ à®ªà®² à®ªà¯‚à®šà¯à®šà®¿à®•à®³à¯à®•à¯à®•à¯ à®ªà®¯à®©à¯à®³à¯à®³à®¤à®¾à®• à®‡à®°à¯à®•à¯à®•à¯à®®à¯.",
            "à®²à¯‡à®Ÿà®¿à®ªà®•à¯à®¸à¯ à®ªà¯‹à®©à¯à®± à®‡à®¯à®±à¯à®•à¯ˆ à®Žà®¤à®¿à®°à®¿à®•à®³à¯ˆ à®…à®±à®¿à®®à¯à®•à®ªà¯à®ªà®Ÿà¯à®¤à¯à®¤à®¿ à®ªà¯‚à®šà¯à®šà®¿à®•à®³à¯ˆ à®•à®Ÿà¯à®Ÿà¯à®ªà¯à®ªà®Ÿà¯à®¤à¯à®¤à¯à®™à¯à®•à®³à¯."
        ]
    },
    "weather": {
        "en": [
            "Please check the local forecast before sowing seeds.",
            "Avoid watering plants if heavy rain is predicted."
        ],
        "hi": [
            "à¤¬à¥€à¤œ à¤¬à¥‹à¤¨à¥‡ à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ à¤¸à¥à¤¥à¤¾à¤¨à¥€à¤¯ à¤®à¥Œà¤¸à¤® à¤ªà¥‚à¤°à¥à¤µà¤¾à¤¨à¥à¤®à¤¾à¤¨ à¤œà¤¾à¤‚à¤šà¥‡à¤‚à¥¤",
            "à¤¯à¤¦à¤¿ à¤­à¤¾à¤°à¥€ à¤¬à¤¾à¤°à¤¿à¤¶ à¤•à¥€ à¤­à¤µà¤¿à¤·à¥à¤¯à¤µà¤¾à¤£à¥€ à¤¹à¥ˆ à¤¤à¥‹ à¤ªà¥Œà¤§à¥‹à¤‚ à¤•à¥‹ à¤ªà¤¾à¤¨à¥€ à¤¨ à¤¦à¥‡à¤‚à¥¤"
        ],
        "ta": [
            "à®µà®¿à®¤à¯ˆà®•à®³à¯ à®µà®¿à®¤à¯ˆà®•à¯à®•à¯à®®à¯ à®®à¯à®©à¯ à®‰à®³à¯à®³à¯‚à®°à¯ à®µà®¾à®©à®¿à®²à¯ˆ à®®à¯à®©à¯à®©à®±à®¿à®µà®¿à®ªà¯à®ªà¯ˆ à®šà®°à®¿à®ªà®¾à®°à¯à®•à¯à®•à®µà¯à®®à¯.",
            "à®•à®©à®®à®´à¯ˆ à®Žà®¤à®¿à®°à¯à®ªà®¾à®°à¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¾à®²à¯ à®¤à®¾à®µà®°à®™à¯à®•à®³à¯à®•à¯à®•à¯ à®¨à¯€à®°à¯ à®Šà®±à¯à®±à¯à®µà®¤à¯ˆ à®¤à®µà®¿à®°à¯à®•à¯à®•à®µà¯à®®à¯."
        ]
    },
    "default": {
        "en": [
            "I'm not sure about that. Could you please rephrase?",
            "Sorry, I don't understand. Can you ask another question?"
        ],
        "hi": [
            "à¤®à¥à¤à¥‡ à¤‰à¤¸à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤¨à¤¿à¤¶à¥à¤šà¤¿à¤¤ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤‡à¤¸à¥‡ à¤¦à¥‹à¤¬à¤¾à¤°à¤¾ à¤ªà¥‚à¤›à¥‡à¤‚à¥¤",
            "à¤®à¤¾à¤«à¤¼ à¤•à¤°à¥‡à¤‚, à¤®à¥à¤à¥‡ à¤¸à¤®à¤ à¤¨à¤¹à¥€à¤‚ à¤†à¤¯à¤¾à¥¤ à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤¦à¥‚à¤¸à¤°à¤¾ à¤¸à¤µà¤¾à¤² à¤ªà¥‚à¤› à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚?"
        ],
        "ta": [
            "à®…à®¤à¯ˆà®ªà¯ à®ªà®±à¯à®±à®¿ à®Žà®©à®•à¯à®•à¯ à®‰à®±à¯à®¤à®¿ à®‡à®²à¯à®²à¯ˆ. à®¤à®¯à®µà¯ à®šà¯†à®¯à¯à®¤à¯ à®®à¯€à®£à¯à®Ÿà¯à®®à¯ à®µà®¿à®³à®•à¯à®•à®®à®¾à®•à®•à¯ à®•à¯‡à®³à¯à®™à¯à®•à®³à¯.",
            "à®®à®©à¯à®©à®¿à®•à¯à®•à®µà¯à®®à¯, à®Žà®©à®•à¯à®•à¯ à®ªà¯à®°à®¿à®¯à®µà®¿à®²à¯à®²à¯ˆ. à®µà¯‡à®±à¯ à®•à¯‡à®³à¯à®µà®¿ à®•à¯‡à®³à¯à®™à¯à®•à®³à¯."
        ]
    }
}

# Keyword mapping (extend as needed)
KEYWORDS = {
    "greeting": {
        "en": ["hello", "hi", "hey"],
        "hi": ["à¤¨à¤®à¤¸à¥à¤¤à¥‡", "à¤¹à¤¾à¤¯", "à¤¹à¥‡à¤²à¥‹"],
        "ta": ["à®µà®£à®•à¯à®•à®®à¯", "à®¹à®¾à®¯à¯"]
    },
    "fertilizer": {
        "en": ["fertilizer", "urea", "compost"],
        "hi": ["à¤‰à¤°à¥à¤µà¤°à¤•", "à¤–à¤¾à¤¦", "à¤¯à¥‚à¤°à¤¿à¤¯à¤¾"],
        "ta": ["à®‰à®°à®®à¯", "à®¯à¯‚à®°à®¿à®¯à®¾", "à®¨à¯ˆà®Ÿà¯à®°à®œà®©à¯"]
    },
    "pest": {
        "en": ["pest", "bug", "insect"],
        "hi": ["à¤•à¥€à¤Ÿ"],
        "ta": ["à®ªà¯‚à®šà¯à®šà®¿"]
    },
    "weather": {
        "en": ["weather", "rain", "forecast"],
        "hi": ["à¤®à¥Œà¤¸à¤®", "à¤¬à¤¾à¤°à¤¿à¤¶", "à¤ªà¥‚à¤°à¥à¤µà¤¾à¤¨à¥à¤®à¤¾à¤¨"],
        "ta": ["à®µà®¾à®©à®¿à®²à¯ˆ", "à®®à®´à¯ˆ"]
    }
}


def detect_language(text: str) -> str:
    """
    Rudimentary language detection using keywords and Unicode ranges.
    Returns one of 'en', 'hi', 'ta' (defaults to 'en').
    """
    if not text:
        return "en"
    txt = text.lower()

    # check for explicit keywords per language
    for lang in ("en", "hi", "ta"):
        for kws in KEYWORDS.values():
            for kw in kws.get(lang, []):
                if kw in txt:
                    return lang

    # fallback: detect by unicode ranges
    for ch in txt:
        if "\u0900" <= ch <= "\u097F":  # Devanagari -> Hindi
            return "hi"
        if "\u0B80" <= ch <= "\u0BFF":  # Tamil
            return "ta"

    return "en"


def get_response(user_input: str) -> str:
    """
    Return a response in the same language as user_input.
    Safe for empty input and always returns a string.
    """
    if not user_input:
        return random.choice(RESPONSES["default"]["en"])

    lang = detect_language(user_input)
    text = user_input.lower()

    # category matching
    if any(k in text for k in KEYWORDS["greeting"].get(lang, [])):
        return random.choice(RESPONSES["greeting"][lang])
    if any(k in text for k in KEYWORDS["fertilizer"].get(lang, [])):
        return random.choice(RESPONSES["fertilizer"][lang])
    if any(k in text for k in KEYWORDS["pest"].get(lang, [])):
        return random.choice(RESPONSES["pest"][lang])
    if any(k in text for k in KEYWORDS["weather"].get(lang, [])):
        return random.choice(RESPONSES["weather"][lang])

    # fallback default in detected language
    return random.choice(RESPONSES["default"][lang])






